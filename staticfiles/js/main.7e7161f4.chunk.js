(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{124:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(9),c=n.n(a),s=n(13),o=(n(97),n(26)),i=n(12),l=n(19),u=n(160),d=n(151),j=n(153),b=n(154),p=n(29),f=n.n(p),x=n(45),m=n(46),h=n.n(m),O="USER_LOGIN_REQUEST",g="USER_LOGIN_SUCCESS",v="USER_LOGIN_FAIL",y="USER_LOGIN_ERROR_RESET",S="USER_LOGOUT",E="USER_REGISTER_REQUEST",I="USER_REGISTER_SUCCESS",w="USER_REGISTER_FAIL",C="USER_REGISTER_RESET",R=function(e,t){return function(){var n=Object(x.a)(f.a.mark((function n(r){var a,c,s;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r({type:O}),a={headers:{"Content-Type":"application/json"}},n.next=5,h.a.post("/api/users/login/",{username:e,password:t},a);case 5:c=n.sent,s=c.data,r({type:g,payload:s}),localStorage.setItem("userInfo",JSON.stringify(s)),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(0),r({type:v,payload:"\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u307e\u305f\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u9593\u9055\u3063\u3066\u3044\u307e\u3059"});case 14:case"end":return n.stop()}}),n,null,[[0,11]])})));return function(e){return n.apply(this,arguments)}}()},_=n(2);var L=function(e){var t=e.userInfo,n=e.setScrollBottom,a=e.setLoading,c=Object(r.useState)(!1),o=Object(l.a)(c,2),i=o[0],p=o[1],f=Object(s.b)();return Object(r.useEffect)((function(){i&&(f((function(e){e({type:S}),localStorage.removeItem("userInfo")})),n(!0),p(!1))}),[f,n,p,i]),Object(_.jsx)(u.a,{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"8rem",bgcolor:"#fff",borderBottom:"1px solid #f6f6f6",p:3,children:Object(_.jsxs)(d.a,{container:!0,className:"max-width",children:[Object(_.jsx)(d.a,{item:!0,xs:!1,sm:3}),Object(_.jsx)(d.a,{item:!0,xs:!t||8,sm:6,children:Object(_.jsx)(j.a,{component:"h1",variant:"h4",color:"primary",align:"center",children:"CHAT ROOM"})}),Object(_.jsx)(d.a,{item:!0,xs:!!t&&4,sm:3,children:t&&Object(_.jsx)(u.a,{textAlign:"right",children:Object(_.jsx)(b.a,{variant:"outlined",color:"primary",onClick:function(){a(!0),p(!0)},children:Object(_.jsx)(j.a,{component:"span",variant:"body2",children:"\u30ed\u30b0\u30a2\u30a6\u30c8"})})})})]})})};var T=function(e){var t=e.bgColor,n=e.color,r=e.text;return Object(_.jsx)(u.a,{style:{backgroundColor:"".concat(t),borderRadius:"0.5rem",padding:"0.5rem 1rem",minWidth:0},children:Object(_.jsx)(u.a,{textAlign:"center",minWidth:"0",children:Object(_.jsx)(j.a,{component:"p",variant:"h5",align:"left",style:{color:"".concat(n),overflowWrap:"break-word"},children:r})})})};var U=function(e){var t=e.text,n=e.date;return Object(_.jsxs)(u.a,{display:"flex",flexDirection:"column",ml:8,pr:2,children:[Object(_.jsx)(u.a,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:Object(_.jsx)(T,{bgColor:"#46b3e6",color:"#fff",text:t})}),Object(_.jsx)(u.a,{display:"flex",justifyContent:"flex-end",alignItems:"center",children:Object(_.jsx)(j.a,{component:"span",variant:"body2",color:"textSecondary",children:n})})]})};var A=function(e){var t=e.username,n=e.text,r=e.date;return Object(_.jsxs)(u.a,{display:"flex",flexDirection:"column",mr:8,pl:2,children:[Object(_.jsx)(u.a,{display:"flex",justifyContent:"flex-start",alignItems:"center",children:Object(_.jsx)(j.a,{component:"span",variant:"h6",color:"textSecondary",children:t})}),Object(_.jsx)(u.a,{display:"flex",justifyContent:"flex-start",alignItems:"center",children:Object(_.jsx)(T,{bgColor:"#dddddd",color:"#000",text:n})}),Object(_.jsx)(u.a,{display:"flex",justifyContent:"flex-start",alignItems:"center",children:Object(_.jsx)(j.a,{component:"span",variant:"body2",color:"textSecondary",children:r})})]})};var N=function(e){var t=e.message,n=e.loginId,r=function(e){var t=Number(e.split(" ")[0]),n=Number(e.split(" ")[1]),r=Number(e.split(" ")[2]),a=Number(e.split(" ")[3]),c=e.split(" ")[4],s=new Date(t,n-1,r),o=new Date,i=Math.floor((o-s)/864e5);return 0===i?"".concat(a,":").concat(c):1===i?"\u6628\u65e5 ".concat(a,":").concat(c):t!==o.getFullYear()?"".concat(t,"/").concat(n,"/").concat(r," ").concat(a,":").concat(c):"".concat(n,"/").concat(r," ").concat(a,":").concat(c)}(t.sent_at);return Object(_.jsx)(u.a,{mb:1,children:n===t.user_id?Object(_.jsx)(U,{text:t.text,date:r}):Object(_.jsx)(A,{username:t.user.username,text:t.text,date:r})})},G="MESSAGE_LIST_REQUEST",k="MESSAGE_LIST_SUCCESS",B="MESSAGE_LIST_FAIL",M="MESSAGE_SEND_REQUEST",P="MESSAGE_SEND_SUCCESS",W="MESSAGE_SEND_FAIL",D="MESSAGE_SEND_RESET",z=function(){return function(){var e=Object(x.a)(f.a.mark((function e(t){var n,r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t({type:G}),n={headers:{"Content-Type":"application/json"}},e.next=5,h.a.get("/api/messages/",n);case 5:r=e.sent,a=r.data,t({type:k,payload:a}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),t({type:B,payload:e.t0});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()};var F=function(e){var t=e.loginId,n=e.scrollBottomRef,a=Object(s.c)((function(e){return e.messageList})).messages,c=Object(s.b)();return Object(r.useEffect)((function(){var e=!0;return function t(){c(z()),e&&setTimeout(t,1e3)}(),function(){return e=!1}}),[c]),Object(_.jsx)(u.a,{p:"2rem 0",children:a&&a.map((function(e,r){return Object(_.jsxs)(u.a,{children:[Object(_.jsx)(N,{message:e,loginId:t}),r+1===a.length&&Object(_.jsx)(u.a,{ref:n,visibility:"hidden",children:"latest message"})]},e.id)}))})};var H=function(e){var t=e.loginId,n=e.scrollBottomRef,r=e.loading;return Object(_.jsx)(u.a,{p:"8rem 0 20rem",maxHeight:"100vh",className:"max-width",mt:"-8rem",style:{overflowY:"scroll",flexWrap:"nowrap"},visibility:r?"hidden":"visible",children:Object(_.jsx)(F,{loginId:t,scrollBottomRef:n})})},q=n(162);var J=function(e){var t=e.setScrollBottom,n=Object(r.useState)(""),a=Object(l.a)(n,2),c=a[0],o=a[1],i=Object(s.c)((function(e){return e.messageSend})).success,d=Object(s.b)();return Object(r.useEffect)((function(){i&&(d({type:D}),d(z()))}),[d,i]),Object(_.jsx)(u.a,{position:"fixed",bottom:"0",left:"0",right:"0",display:"flex",justifyContent:"center",alignItems:"center",bgcolor:"#fff",children:Object(_.jsx)(u.a,{borderTop:"1px solid #dddddd",borderBottom:"1px solid #dddddd",p:2,width:"100%",children:Object(_.jsx)("form",{onSubmit:function(){t(!0),d(function(e){return function(){var t=Object(x.a)(f.a.mark((function t(n,r){var a,c,s,o,i;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n({type:M}),a=r(),c=a.userLogin.userInfo,s={headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c.token)}},t.next=6,h.a.post("/api/messages/send/",{text:e},s);case 6:o=t.sent,i=o.data,n({type:P,payload:i}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),n({type:W,payload:t.t0});case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e,n){return t.apply(this,arguments)}}()}(c)),o("")},children:Object(_.jsxs)(u.a,{display:"flex",width:"100%",maxHeight:"10rem",className:"max-width",children:[Object(_.jsx)(u.a,{display:"flex",justifyContent:"flex-start",width:"100%",bgcolor:"#fafafa",children:Object(_.jsx)(q.a,{fullWidth:!0,multiline:!0,autoFocus:!0,rowsMax:6,value:c,placeholder:"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",onChange:function(e){return o(e.target.value)},style:{fontSize:"1.4rem",border:"1rem solid #fafafa"}})}),Object(_.jsx)(u.a,{display:"flex",justifyContent:"flex-end",children:Object(_.jsx)(b.a,{type:"submit",color:"primary",disabled:!c||!c.match(/\S/g),children:Object(_.jsx)(j.a,{component:"span",variant:"h5",children:"\u9001\u4fe1"})})})]})})})})};var Q=function(){return Object(_.jsx)(u.a,{position:"fixed",bottom:"0",left:"0",right:"0",height:"10rem",bgcolor:"#fff",borderTop:"1px solid #dddddd",borderBottom:"1px solid #dddddd",children:Object(_.jsx)(u.a,{padding:"1rem",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:Object(_.jsx)(o.b,{to:"/login",children:Object(_.jsx)(b.a,{color:"primary",children:Object(_.jsx)(j.a,{component:"span",variant:"h5",children:"\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4f1a\u8a71\u306b\u53c2\u52a0\u3059\u308b"})})})})})};var Y=function(){var e=Object(r.useState)(!0),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(!0),o=Object(l.a)(c,2),i=o[0],d=o[1],j=Object(s.c)((function(e){return e.userLogin})).userInfo,b=Object(s.c)((function(e){return e.messageList})).messages,p=Object(r.useRef)(null);return Object(r.useEffect)((function(){p&&p.current&&n&&(a(!1),p.current.scrollIntoView(),setTimeout((function(){return d(!1)}),300))}),[b,n]),Object(_.jsxs)(u.a,{children:[Object(_.jsx)(L,{userInfo:j,setScrollBottom:a,setLoading:d}),Object(_.jsx)(H,{loginId:j?j.id:null,scrollBottomRef:p,loading:i}),j?Object(_.jsx)(J,{setScrollBottom:a}):Object(_.jsx)(Q,{})]})},V=n(155),K=n(73),X=n.n(K);var Z=function(e){var t=e.title,n=e.color;return Object(_.jsxs)(d.a,{container:!0,alignItems:"center",children:[Object(_.jsx)(d.a,{item:!0,xs:3,children:Object(_.jsx)(o.b,{to:"/",children:Object(_.jsx)(V.a,{color:n,children:Object(_.jsx)(X.a,{fontSize:"large"})})})}),Object(_.jsx)(d.a,{item:!0,xs:6,children:Object(_.jsx)(j.a,{component:"h1",variant:"h4",color:n,children:t})}),Object(_.jsx)(d.a,{item:!0,xs:3})]})},$=n(158);var ee=function(e){var t=e.onSubmit,n=e.buttonTitle,r=e.buttonColor,a=e.children;return Object(_.jsxs)("form",{onSubmit:t,children:[a,Object(_.jsx)(u.a,{mt:5,children:Object(_.jsx)(b.a,{type:"submit",variant:"contained",color:r,style:{width:"100%",padding:"1rem 3rem"},children:Object(_.jsx)(j.a,{component:"span",variant:"h6",children:n})})})]})};var te=function(e){var t=e.loginHandler,n=e.username,r=e.setUsername,a=e.password,c=e.setPassword,s={fontSize:"1.5rem"},o={fontSize:"1.5rem"};return Object(_.jsxs)(ee,{onSubmit:t,buttonTitle:"\u30ed\u30b0\u30a4\u30f3",buttonColor:"primary",children:[Object(_.jsx)($.a,{autoFocus:!0,autoComplete:"username",variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:"\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0",InputLabelProps:{style:s},InputProps:{style:o},value:n,onChange:function(e){return r(e.target.value)}}),Object(_.jsx)($.a,{autoComplete:"current-password",variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:"\u30d1\u30b9\u30ef\u30fc\u30c9",InputLabelProps:{style:s},InputProps:{style:o},type:"password",value:a,onChange:function(e){return c(e.target.value)}})]})},ne=n(157);var re=function(e){var t=e.style;return Object(_.jsx)(u.a,{textAlign:"center",m:"0 auto",style:t,children:Object(_.jsx)(ne.a,{size:"3rem",color:"secondary",children:Object(_.jsx)(j.a,{variant:"srOnly",children:"Loading..."})})})},ae=n(161);var ce=function(e){var t=e.children;return Object(_.jsx)(ae.a,{severity:"error",children:Object(_.jsx)(j.a,{variant:"body2",align:"left",children:t})})};var se=function(e){var t=e.to,n=e.children;return Object(_.jsx)(o.b,{to:t,children:Object(_.jsx)(j.a,{variant:"h6",children:n})})};var oe=function(){var e=Object(r.useState)(""),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),o=Object(l.a)(c,2),d=o[0],j=o[1],b=Object(s.b)(),p=Object(i.f)(),f=Object(s.c)((function(e){return e.userLogin})),x=f.loading,m=f.userInfo,h=f.error;return Object(r.useEffect)((function(){m&&p.push("/")}),[p,m]),Object(r.useEffect)((function(){return function(){return b({type:y})}}),[b]),Object(_.jsxs)(u.a,{textAlign:"center",maxWidth:"320px",m:"0 auto",px:3,children:[Object(_.jsx)(u.a,{pt:5,mb:5,children:Object(_.jsx)(Z,{title:"\u30ed\u30b0\u30a4\u30f3",color:"primary"})}),x?Object(_.jsx)(re,{}):Object(_.jsxs)(u.a,{children:[h&&Object(_.jsx)(ce,{children:h}),Object(_.jsx)(te,{loginHandler:function(){return b(R(n,d))},username:n,setUsername:a,password:d,setPassword:j}),Object(_.jsx)(u.a,{mt:5,children:Object(_.jsx)(se,{to:"/register",children:"\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u3042\u308a\u307e\u305b\u3093\u304b\uff1f \u767b\u9332\u3059\u308b"})})]})]})};var ie=function(e){var t=e.registerHandler,n=e.username,r=e.setUsername,a=e.password,c=e.setPassword,s={fontSize:"1.5rem"},o={fontSize:"1.5rem"};return Object(_.jsxs)(ee,{onSubmit:t,buttonTitle:"\u767b\u9332",buttonColor:"secondary",children:[Object(_.jsx)($.a,{autoFocus:!0,autoComplete:"username",variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:"\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0",InputLabelProps:{style:s},InputProps:{style:o},value:n,onChange:function(e){return r(e.target.value)}}),Object(_.jsx)($.a,{autoComplete:"current-password",variant:"outlined",margin:"normal",required:!0,fullWidth:!0,label:"\u30d1\u30b9\u30ef\u30fc\u30c9",InputLabelProps:{style:s},InputProps:{style:o},type:"password",value:a,onChange:function(e){return c(e.target.value)}})]})};var le=function(){var e=Object(r.useState)(""),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),o=Object(l.a)(c,2),d=o[0],j=o[1],b=Object(s.b)(),p=Object(i.f)(),m=Object(s.c)((function(e){return e.userLogin})),O=m.loading,g=m.userInfo,v=Object(s.c)((function(e){return e.userRegister})),y=v.loading,S=v.success,L=v.error;return Object(r.useEffect)((function(){g&&p.push("/")}),[p,g]),Object(r.useEffect)((function(){S&&(b({type:C}),b(R(n,d)))}),[b,S,n,d]),Object(r.useEffect)((function(){return function(){return b({type:C})}}),[b]),Object(_.jsxs)(u.a,{textAlign:"center",maxWidth:"320px",m:"0 auto",px:3,children:[Object(_.jsx)(u.a,{pt:5,mb:5,children:Object(_.jsx)(Z,{title:"\u30e6\u30fc\u30b6\u30fc\u767b\u9332",color:"secondary"})}),O||y?Object(_.jsx)(re,{}):Object(_.jsxs)(u.a,{children:[L&&Object(_.jsx)(ce,{children:L}),Object(_.jsx)(ie,{registerHandler:function(){return b(function(e,t){return function(){var n=Object(x.a)(f.a.mark((function n(r){var a,c,s;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r({type:E}),a={headers:{"Content-Type":"application/json"}},n.next=5,h.a.post("/api/users/register/",{username:e,password:t},a);case 5:c=n.sent,s=c.data,r({type:I,payload:s}),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),r({type:w,payload:n.t0.response&&n.t0.response.data.detail?n.t0.response.data.detail:n.t0.message});case 13:case"end":return n.stop()}}),n,null,[[0,10]])})));return function(e){return n.apply(this,arguments)}}()}(n,d))},username:n,setUsername:a,password:d,setPassword:j}),Object(_.jsx)(u.a,{mt:5,children:Object(_.jsx)(se,{to:"/login",children:"\u65e2\u306b\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u3042\u308a\u307e\u3059\u304b\uff1f \u30ed\u30b0\u30a4\u30f3\u3059\u308b"})})]})]})};var ue=function(){return Object(_.jsx)(o.a,{children:Object(_.jsxs)(i.c,{children:[Object(_.jsx)(i.a,{exact:!0,path:"/",component:Y}),Object(_.jsx)(i.a,{exact:!0,path:"/login",component:oe}),Object(_.jsx)(i.a,{exact:!0,path:"/register",component:le}),Object(_.jsx)(i.a,{component:Y})]})})},de=n(44),je=n(74),be=n(75),pe=Object(de.combineReducers)({userLogin:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return{loading:!0};case g:return{loading:!1,userInfo:t.payload};case v:return{loading:!1,error:t.payload};case y:return delete e.error,e;case S:return{};default:return e}},userRegister:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E:return{loading:!0};case I:return{loading:!1,success:!0,userInfo:t.payload};case w:return{loading:!1,error:t.payload};case C:return{};default:return e}},messageList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case G:return{loading:!0,messages:e.messages};case k:return{loading:!1,messages:t.payload};case B:return{loading:!1,error:t.payload};default:return e}},messageSend:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:return{loading:!0};case P:return{loading:!1,success:!0,sentMessage:t.payload};case W:return{loading:!1,error:t.payload};case D:return{};default:return e}}}),fe={userLogin:{userInfo:localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")):null}},xe=[je.a],me=Object(de.createStore)(pe,fe,Object(be.composeWithDevTools)(de.applyMiddleware.apply(void 0,xe)));c.a.render(Object(_.jsx)(s.a,{store:me,children:Object(_.jsx)(ue,{})}),document.getElementById("root"))},97:function(e,t,n){}},[[124,1,2]]]);
//# sourceMappingURL=main.7e7161f4.chunk.js.map